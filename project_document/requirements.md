# Cloudflare 导航网站 - 项目需求文档

## 📋 执行摘要

**项目名称**: Cloudflare 导航网站 (CF-Nav)
**项目类型**: 基于 Cloudflare 免费套餐的 Serverless 导航网站
**核心价值**: 提供零成本、快速部署的个人/团队导航网站解决方案
**技术栈**: Cloudflare Pages + Workers + D1 Database
**目标用户**: 开发者、技术团队、个人用户

---

## 🎯 项目目标

### 主要目标
1. 提供完全基于 Cloudflare 免费套餐的导航网站解决方案
2. 实现一键部署，降低技术门槛
3. 提供直观的后台管理界面，方便快捷管理链接
4. 自动化网站信息抓取，提升用户体验

### 成功指标
- 部署时间 < 5 分钟
- 链接添加操作 < 30 秒
- 网站加载时间 < 2 秒
- 移动端适配良好（响应式设计）

---

## 👥 利益相关者分析

### 主要用户角色

#### 1. 网站访客 (Visitor)
**描述**: 访问导航网站查找链接的普通用户
**需求**:
- 快速加载和浏览链接
- 清晰的分类导航
- 美观现代的界面
- 移动端友好的体验

#### 2. 网站管理员 (Admin)
**描述**: 负责管理导航网站内容的用户
**需求**:
- 安全的登录认证
- 快捷的链接管理（增删改查）
- 分类管理能力
- 自动化信息抓取
- 一键部署和配置

#### 3. 部署者 (Deployer)
**描述**: 初次部署网站的技术用户
**需求**:
- 清晰的部署文档
- 一键部署脚本
- 环境配置指导
- 故障排查指南

---

## 📊 功能需求

### FR-001: 用户认证系统
**优先级**: P0 (必须实现)
**描述**: 提供安全的用户注册和登录功能

**详细需求**:
- 用户注册（邮箱 + 密码）
- 用户登录（支持会话管理）
- 密码加密存储（bcrypt 或 Argon2）
- 登录状态持久化（JWT Token）
- 退出登录功能

**验收标准**:
- [ ] 用户可以成功注册账号
- [ ] 用户可以使用邮箱和密码登录
- [ ] 密码以加密形式存储在 D1 数据库
- [ ] 登录后生成有效的 JWT Token
- [ ] Token 在 24 小时后自动过期
- [ ] 用户可以安全退出登录
- [ ] 密码长度至少 8 位，包含字母和数字
- [ ] 防止重复注册同一邮箱

**边缘情况**:
- 用户输入无效邮箱格式
- 用户输入弱密码
- 用户重复提交注册请求
- Token 过期后访问受保护资源
- 数据库连接失败时的错误处理

---

### FR-002: 链接管理功能
**优先级**: P0 (必须实现)
**描述**: 管理员可以添加、编辑、删除导航链接

**详细需求**:
- 添加链接（URL、标题、描述、分类）
- 编辑已有链接信息
- 删除链接
- 批量删除功能
- 链接排序（拖拽或手动设置顺序）

**验收标准**:
- [ ] 管理员可以成功添加新链接
- [ ] 添加链接时支持输入 URL、标题、描述、分类
- [ ] 管理员可以编辑已有链接的任意字段
- [ ] 管理员可以删除单个链接
- [ ] 管理员可以批量删除多个链接
- [ ] 链接支持自定义排序（数字序号或拖拽）
- [ ] 删除操作需要二次确认
- [ ] 所有操作立即同步到数据库

**边缘情况**:
- 添加无效的 URL（格式错误）
- 添加重复的 URL
- 删除不存在的链接
- 编辑时网络中断
- 批量操作时部分失败

---

### FR-003: 自动网站信息抓取
**优先级**: P1 (高优先级)
**描述**: 添加链接时自动抓取网站的 title、logo、icon

**详细需求**:
- 自动获取网页 `<title>` 标签
- 自动获取网站 favicon
- 自动获取网站 logo（Open Graph 或 meta 标签）
- 支持手动修改抓取结果
- 抓取失败时提供默认值

**验收标准**:
- [ ] 输入 URL 后自动发起抓取请求
- [ ] 成功获取网页 title 并填充标题字段
- [ ] 成功获取 favicon 并显示预览
- [ ] 成功获取网站 logo（如果存在）
- [ ] 抓取过程显示加载状态
- [ ] 抓取超时时间设置为 10 秒
- [ ] 抓取失败时使用默认图标和提示
- [ ] 用户可以手动修改自动抓取的信息
- [ ] 抓取过程不阻塞其他操作

**边缘情况**:
- 目标网站无法访问
- 目标网站响应超时
- 目标网站无 favicon
- 目标网站无 Open Graph 标签
- 目标网站使用 JavaScript 渲染（无法抓取）
- CORS 限制导致抓取失败

**技术实现建议**:
- 使用 Cloudflare Workers 进行服务端抓取（避免 CORS）
- 解析 HTML 获取 `<link rel="icon">` 或 `<meta property="og:image">`
- 缓存抓取结果（减少重复请求）

---

### FR-004: 分类管理
**优先级**: P0 (必须实现)
**描述**: 支持创建、编辑、删除分类，并将链接分配到分类

**详细需求**:
- 创建新分类（名称、图标、颜色）
- 编辑分类信息
- 删除分类（处理分类下的链接）
- 分类排序
- 为链接指定分类

**验收标准**:
- [ ] 管理员可以创建新分类
- [ ] 分类支持设置名称、图标（可选）、颜色（可选）
- [ ] 管理员可以编辑分类信息
- [ ] 删除分类时提供两种选项：删除所有链接 / 将链接移至"未分类"
- [ ] 分类支持自定义排序
- [ ] 添加链接时可以选择分类
- [ ] 每个链接只能属于一个分类
- [ ] 未分类的链接自动归入"默认分类"

**边缘情况**:
- 删除包含大量链接的分类
- 创建同名分类
- 删除默认分类
- 分类数量超过限制（建议最多 20 个）

---

### FR-005: 前端展示页面
**优先级**: P0 (必须实现)
**描述**: 提供美观、响应式的导航页面供访客浏览

**详细需求**:
- 响应式布局（支持桌面、平板、手机）
- 分类导航栏
- 链接卡片展示（显示 logo、标题、描述）
- 搜索功能（按标题或描述搜索）
- 点击链接在新标签页打开

**验收标准**:
- [ ] 页面在桌面端正常显示（宽度 > 1024px）
- [ ] 页面在移动端正常显示（宽度 < 768px）
- [ ] 分类以标签或侧边栏形式展示
- [ ] 链接卡片显示 logo、标题、描述
- [ ] 搜索框支持实时过滤链接
- [ ] 点击链接在新标签页打开（`target="_blank"`）
- [ ] 页面加载时间 < 2 秒
- [ ] 支持深色模式（可选）

**边缘情况**:
- 分类数量过多时的显示处理
- 链接数量过多时的分页或虚拟滚动
- 图片加载失败时的占位符显示
- 搜索无结果时的提示

---

### FR-006: 一键部署功能
**优先级**: P0 (必须实现)
**描述**: 提供自动化部署脚本和文档，支持一键部署到 Cloudflare

**详细需求**:
- 提供部署脚本（CLI 工具或 GitHub Actions）
- 自动创建 Cloudflare Pages 项目
- 自动创建 Cloudflare Workers
- 自动创建 D1 数据库并初始化表结构
- 自动绑定服务（Pages + Workers + D1）

**验收标准**:
- [ ] 提供 CLI 部署工具（如 `npm run deploy`）
- [ ] 部署脚本自动检测 Cloudflare API Token
- [ ] 自动创建 Pages 项目并上传前端代码
- [ ] 自动创建 Workers 并部署 API 代码
- [ ] 自动创建 D1 数据库并执行 SQL 初始化脚本
- [ ] 自动绑定 Workers 与 D1 数据库
- [ ] 部署成功后输出网站 URL
- [ ] 提供详细的部署日志
- [ ] 部署失败时提供错误提示和回滚机制

**边缘情况**:
- Cloudflare API Token 无效
- 网络连接失败
- 项目名称冲突
- D1 数据库已存在
- 部署过程中断

**技术实现建议**:
- 使用 Wrangler CLI（Cloudflare 官方工具）
- 提供 `wrangler.toml` 配置模板
- 提供 GitHub Actions 工作流（可选）

---

### FR-007: 后台管理界面
**优先级**: P0 (必须实现)
**描述**: 提供简洁、高效的后台管理界面

**详细需求**:
- 登录页面
- 仪表盘（显示统计信息：链接总数、分类总数）
- 链接管理页面（表格或卡片视图）
- 分类管理页面
- 用户设置页面（修改密码、个人信息）

**验收标准**:
- [ ] 未登录用户访问后台自动跳转到登录页
- [ ] 登录成功后跳转到仪表盘
- [ ] 仪表盘显示链接总数、分类总数、最近添加的链接
- [ ] 链接管理页面支持搜索、过滤、排序
- [ ] 分类管理页面支持拖拽排序
- [ ] 用户设置页面可以修改密码
- [ ] 后台界面响应式设计（支持移动端）
- [ ] 操作反馈（成功提示、错误提示）

**边缘情况**:
- 长时间未操作导致登录过期
- 同时打开多个后台标签页
- 网络不稳定时的操作处理

---

## 🔒 非功能需求

### NFR-001: 性能要求
**描述**: 确保网站在全球范围内快速加载

**指标**:
- 首页加载时间 < 2 秒（LCP - Largest Contentful Paint）
- API 响应时间 < 500ms (95% 请求)
- Time to Interactive (TTI) < 3 秒
- Cloudflare CDN 全球加速

**验收标准**:
- [ ] 使用 Lighthouse 测试性能分数 > 90
- [ ] 使用 WebPageTest 测试全球加载速度
- [ ] API 接口平均响应时间 < 300ms
- [ ] 图片使用懒加载
- [ ] 静态资源启用 Cloudflare 缓存

---

### NFR-002: 安全要求
**描述**: 保护用户数据和系统安全

**标准**:
- HTTPS 强制加载
- 密码加密存储（bcrypt 或 Argon2）
- JWT Token 安全传输（HttpOnly Cookie 或 Authorization Header）
- SQL 注入防护（使用参数化查询）
- XSS 防护（输入验证和输出转义）
- CSRF 防护（Token 验证）
- 限流保护（防止暴力破解和 DDoS）

**验收标准**:
- [ ] 所有 HTTP 请求自动重定向到 HTTPS
- [ ] 密码存储使用 bcrypt (cost factor ≥ 10)
- [ ] JWT Token 包含过期时间
- [ ] 所有数据库查询使用 Prepared Statements
- [ ] 用户输入经过 HTML 转义
- [ ] 登录接口限流（5 次/分钟）
- [ ] API 接口限流（100 次/分钟）

---

### NFR-003: 可用性要求
**描述**: 确保系统稳定运行

**指标**:
- 系统可用性 > 99.9%（依赖 Cloudflare SLA）
- 数据库备份（D1 自动备份）
- 错误监控和日志记录

**验收标准**:
- [ ] Cloudflare 提供 99.9% 以上的 SLA
- [ ] D1 数据库启用自动备份
- [ ] 关键错误记录到日志（Cloudflare Workers Logs）
- [ ] 提供健康检查接口（`/api/health`）

---

### NFR-004: 可维护性要求
**描述**: 代码质量和可维护性

**标准**:
- 代码规范（ESLint + Prettier）
- TypeScript 强类型（无 `any`）
- 单元测试覆盖率 > 70%
- API 文档（OpenAPI/Swagger）
- 部署文档和用户手册

**验收标准**:
- [ ] 所有代码通过 ESLint 检查
- [ ] TypeScript 编译无警告
- [ ] 核心功能有单元测试
- [ ] 提供 API 文档（Swagger UI）
- [ ] 提供详细的 README.md

---

### NFR-005: 可扩展性要求
**描述**: 支持未来功能扩展

**考虑因素**:
- 数据库表结构预留扩展字段
- API 版本控制（`/api/v1/`）
- 插件化架构（可选）
- 支持自定义主题（可选）

**验收标准**:
- [ ] 数据库表包含 `created_at` 和 `updated_at` 字段
- [ ] API 路由包含版本前缀
- [ ] 前端支持主题切换（可选）

---

### NFR-006: 可访问性要求 (A11y)
**描述**: 符合 Web 可访问性标准

**标准**:
- WCAG 2.1 AA 级别
- 语义化 HTML
- 键盘导航支持
- 屏幕阅读器友好

**验收标准**:
- [ ] 使用语义化标签（`<nav>`, `<main>`, `<article>`）
- [ ] 图片包含 `alt` 属性
- [ ] 表单元素包含 `<label>`
- [ ] 支持键盘操作（Tab 导航、Enter 确认）
- [ ] 使用 ARIA 属性增强可访问性

---

## ⚠️ 约束条件

### 技术约束
1. **必须使用 Cloudflare 免费套餐**
   - Cloudflare Pages: 500 次构建/月
   - Cloudflare Workers: 100,000 次请求/天
   - Cloudflare D1: 5GB 存储，500 万行数据读取/天

2. **数据库限制**
   - D1 基于 SQLite，不支持复杂的联表查询
   - D1 单表行数限制（建议 < 10,000 行）

3. **Workers 限制**
   - 单次请求 CPU 时间 < 50ms（免费套餐）
   - 内存限制 128MB

### 业务约束
1. **单用户系统**（初期只支持单管理员，避免复杂的权限管理）
2. **链接数量限制**（建议 < 500 个链接，确保性能）
3. **分类数量限制**（建议 < 20 个分类）

### 法规约束
- 遵守 GDPR（如果面向欧盟用户）
- 遵守 CCPA（如果面向美国加州用户）
- 用户数据存储在 Cloudflare 数据中心（需告知用户）

---

## 🔍 假设

1. **用户技术背景**: 假设部署者具有基本的命令行操作能力和 Cloudflare 账号
2. **网络环境**: 假设用户有稳定的互联网连接
3. **浏览器支持**: 假设用户使用现代浏览器（Chrome, Firefox, Safari, Edge 最新版本）
4. **Cloudflare 服务可用性**: 假设 Cloudflare 服务稳定运行（依赖其 SLA）
5. **链接目标网站可访问**: 假设添加的链接指向的网站可公开访问

---

## 🚫 范围外 (Out of Scope)

以下功能**不在**本项目范围内：

1. **多用户协作**: 不支持多管理员、权限管理
2. **链接统计**: 不提供点击统计、访问分析（可作为 v2.0 功能）
3. **评论功能**: 不支持用户评论或评分
4. **社交分享**: 不集成社交媒体分享按钮
5. **移动应用**: 仅提供 Web 版本，不开发原生移动应用
6. **SEO 优化**: 基础 SEO 支持，但不做深度优化
7. **国际化 (i18n)**: 仅支持中文，不提供多语言版本
8. **自定义域名配置**: 用户需自行在 Cloudflare 配置域名
9. **数据导入/导出**: 不提供批量导入导出功能（可作为 v2.0 功能）
10. **高级搜索**: 仅支持简单的标题/描述搜索，不支持标签、日期筛选

---

## 📈 优先级定义

- **P0 (必须实现)**: 核心功能，缺少则产品不可用
- **P1 (高优先级)**: 重要功能，显著提升用户体验
- **P2 (中优先级)**: 可选功能，可后续迭代添加

### 优先级分配

| 功能 | 优先级 | 理由 |
|-----|-------|------|
| 用户认证系统 | P0 | 保护后台管理功能 |
| 链接管理 | P0 | 核心功能 |
| 分类管理 | P0 | 核心功能 |
| 前端展示页面 | P0 | 用户入口 |
| 一键部署 | P0 | 降低部署门槛 |
| 后台管理界面 | P0 | 管理员操作界面 |
| 自动信息抓取 | P1 | 显著提升体验，但可手动输入 |
| 搜索功能 | P1 | 链接较多时非常有用 |
| 深色模式 | P2 | 用户体验加分项 |
| 自定义主题 | P2 | 个性化需求 |

---

## 🎨 用户体验考虑

### 视觉设计原则
- **简洁**: 界面干净，避免过度设计
- **现代化**: 使用流行的设计风格（卡片式布局、圆角、阴影）
- **一致性**: 统一的色彩、字体、间距
- **响应式**: 适配各种屏幕尺寸

### 交互设计原则
- **即时反馈**: 操作后立即显示结果（成功/失败提示）
- **容错性**: 重要操作需要二次确认（删除）
- **引导性**: 首次使用提供引导提示
- **快捷操作**: 支持键盘快捷键（可选）

### 推荐 UI 框架
- **前端**: Tailwind CSS + DaisyUI / Shadcn UI
- **图标**: Heroicons / Lucide Icons
- **字体**: Inter / Noto Sans SC

---

## 🔄 风险与缓解措施

| 风险 | 影响 | 可能性 | 缓解措施 |
|-----|------|-------|---------|
| Cloudflare 免费套餐限制 | 高 | 中 | 监控使用量，提供升级指导 |
| D1 数据库性能瓶颈 | 中 | 低 | 限制链接数量，优化查询 |
| 网站信息抓取失败 | 低 | 高 | 提供手动输入，使用默认图标 |
| 部署失败 | 高 | 中 | 详细文档，自动回滚机制 |
| 安全漏洞 | 高 | 低 | 代码审计，安全测试 |
| 浏览器兼容性问题 | 中 | 低 | 测试主流浏览器，提供降级方案 |

---

## 📚 参考资料

- [Cloudflare Pages 文档](https://developers.cloudflare.com/pages/)
- [Cloudflare Workers 文档](https://developers.cloudflare.com/workers/)
- [Cloudflare D1 文档](https://developers.cloudflare.com/d1/)
- [Wrangler CLI 文档](https://developers.cloudflare.com/workers/wrangler/)
- [WCAG 2.1 标准](https://www.w3.org/WAI/WCAG21/quickref/)

---

## 📝 文档版本

| 版本 | 日期 | 作者 | 变更说明 |
|-----|------|------|---------|
| 1.0 | 2026-01-20 | Claude (需求分析专家) | 初始版本 |

---

**文档状态**: ✅ 已完成
**下一步行动**: 创建用户故事 (user-stories.md)
